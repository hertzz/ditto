<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Ditto : Bash driven backup utility for Amazon AWS" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Ditto</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/tommyjohnson/ditto">View on GitHub</a>

          <h1 id="project_title">Ditto</h1>
          <h2 id="project_tagline">Bash driven backup utility for Amazon AWS</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/tommyjohnson/ditto/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/tommyjohnson/ditto/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>Ditto-Backup</h1>

<p>A simple bash driven MySQL and local file backup system for archiving files to Amazon AWS Simple Storage Service.</p>

<ol>
<li>Installation</li>
<li>Configuration</li>
<li>Troubleshooting</li>
</ol><h4>1. Installation</h4>

<p>To get started installing Ditto, you can run the following command which will download and install all features:</p>

<pre><code>$ curl https://raw.github.com/tommyjohnson/ditto/master/bin/install-ditto | sh
</code></pre>

<p>By running the above command, Ditto will automatically install a cronjob in <strong>/etc/cron.d</strong>. The cronjob itself runs as the root user, however you can change this by modifying <strong>/etc/cron.d/ditto-backup.cron</strong>. The cronjob makes Ditto execute every minute continuously which will fire off the boostrap process and procedurally trigger any actions defined in the schedules directory (presuming they are allowed to run at that point in time).</p>

<h4>2. Configuration</h4>

<h5>MySQL backups</h5>

<p>If you need to backup one or more databases, you will need to configure a MySQL schedule for Ditto which will periodically back up your important data. To start, you can either create a new MySQL schedule, or you can edit the existing schedule stub which has been provided for you.</p>

<p>Goto the Ditto schedules directory:</p>

<pre><code>$ cd /opt/ditto/schedules
</code></pre>

<p>If creating a new MySQL schedule, create a file in the above directory which describes the action in a way you can easily determine what it's doing, prefixed with a 3 digit number and prepended with <strong>".mysql</strong>".</p>

<pre><code>$ touch 003-all-production-databases.mysql
</code></pre>

<p>If you want to use the existing stub, open the default schedule to edit it:</p>

<pre><code>$ vi 001-all-databases.mysql
</code></pre>

<p>The number prefix before the action description is used to process schedules in a specific order. Files do not need to have a unique number in their filename.</p>

<p>The <strong>".mysql"</strong> file extension tells Ditto to use the MySQL action handler to deal with the schedule.</p>

<p>To get the blank schedule running, you will need to add the action instructions into the file which you created above:</p>

<pre><code>$ vi /opt/ditto/schedules/003-all-production-databases.mysql
</code></pre>

<p>Add the following content into the schedule:</p>

<pre><code>#!/usr/bin/env bash
#

WHEN="0 21 * * *"

MYSQL_USERNAME=username
MYSQL_PASSWORD=password
#MYSQL_DATABASES=all
#MYSQL_HOSTNAME=localhost
#MYSQL_GZIP_DATA=false
#MYSQL_DATED_DUMP=true
#MYSQL_HOTCOPY=false
</code></pre>

<p>You will need to change the Username and Password properties, however all of the other settings will work as their defaults.</p>

<p>To back up individual databases, change the databases property to a space seperated list of database names in double quotes.</p>

<p>The <strong>WHEN</strong> property is used to tell the schedule when it is allowed to execute. The string specified for WHEN refers to a dumbed down version of a regular cron expression. For example, if you wanted the MySQL schedule to run at 02:25 PM daily, you would specify the following:</p>

<pre><code>WHEN="25 14 * * *"
</code></pre>

<p>The expressions, however, <strong>do not support advanced operators</strong>. Basically, you can only use single or double digit numbers for all of the values. An asterisk implies that it should always run for that specific field. (See the cron man page for more information about the field orders).</p>

<h5>S3 backups (Simple storage service)</h5>

<p>If you want to backup files to S3, you will need to configure an S3 schedule for Ditto which will periodically push your important data to the cloud. To start, you can either create a new S3 schedule, or you can edit the existing schedule stub which has been provided for you.</p>

<p>Goto the Ditto schedules directory:</p>

<pre><code>$ cd /opt/ditto/schedules
</code></pre>

<p>If creating a new S3 schedule, create a file in the above directory which describes the action in a way you can easily determine what it's doing, prefixed with a 3 digit number and prepended with <strong>".mysql</strong>".</p>

<pre><code>$ touch 900-backups.s3
</code></pre>

<p>If you want to use the existing stub, open the default schedule to edit it:</p>

<pre><code>$ vi 999-backup.s3
</code></pre>

<p>The number prefix before the action description is used to process schedules in a specific order. Files do not need to have a unique number in their filename.</p>

<p>The <strong>".s3"</strong> file extension tells Ditto to use the S3 action handler to deal with the schedule.</p>

<p>To get the blank schedule running, you will need to add the action instructions into the file which you created above:</p>

<pre><code>$ vi /opt/ditto/schedules/900-backups.s3
</code></pre>

<p>Add the following content into the schedule:</p>

<pre><code>#!/usr/bin/env bash
#

WHEN="0 23 * * *"

S3_ACCESS_KEY=""
S3_SECRET_KEY=""
S3_BUCKET_URI=""
S3_USE_ENCRYPTION=false
S3_USE_COMPRESSION=false
#S3_MD5_CHECKING=true
#S3_REMOVE_DELETED=false
#S3_PRESERVE_PERMISSIONS=true
S3_MAX_CPU=75
</code></pre>

<p>You will need to set the access key, secret key and bucket URI properties, however all of the other settings will work as their defaults.</p>

<p>When the S3 schedule runs, it will automatically synchronize all files from the Ditto backups directory to the specified Bucket location which by default is <strong>/opt/ditto/backups</strong>.</p>

<p>You can override the path which the schedule is using as the source location by configuring the following property:</p>

<pre><code>S3_BACKUP_DIR=/path/to/my/dir
</code></pre>

<p>The <strong>WHEN</strong> property is used to tell the schedule when it is allowed to execute. The string specified for WHEN refers to a dumbed down version of a regular cron expression. For example, if you wanted the S3 schedule to run at 04:45 PM daily, you would specify the following:</p>

<pre><code>WHEN="45 16 * * *"
</code></pre>

<p>The expressions, however, <strong>do not support advanced operators</strong>. Basically, you can only use single or double digit numbers for all of the values. An asterisk implies that it should always run for that specific field. (See the cron man page for more information about the field orders).</p>

<h4>3. Troubleshooting</h4>

<p>All logging information is by default, written to /var/log/ditto.log. You can tail the log file to look for any errors being raised about potential problems:</p>

<pre><code>$ tail -f /var/log/ditto.log
</code></pre>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Ditto maintained by <a href="https://github.com/tommyjohnson">tommyjohnson</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
