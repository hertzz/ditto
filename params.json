{"name":"Ditto","tagline":"Bash driven backup utility","body":"# Ditto-Backup #\r\nA simple bash driven MySQL and local file backup system for archiving files to Amazon AWS Simple Storage Service.\r\n\r\n1. Installation\r\n2. Configuration\r\n3. Troubleshooting\r\n\r\n#### 1. Installation ####\r\nTo get started installing Ditto, you can run the following command which will download and install all features:\r\n\r\n\t$ curl https://raw.github.com/tommyjohnson/ditto/master/bin/install-ditto | sh\r\n\r\nBy running the above command, Ditto will automatically install a cronjob in **/etc/cron.d**. The cronjob itself runs as the root user, however you can change this by modifying **/etc/cron.d/ditto-backup.cron**. The cronjob makes Ditto execute every minute continuously which will fire off the boostrap process and procedurally trigger any actions defined in the schedules directory (presuming they are allowed to run at that point in time).\r\n\r\n#### 2. Configuration ####\r\n\r\n#####MySQL backups#####\r\n\r\nIf you need to backup one or more databases, you will need to configure a MySQL schedule for Ditto which will periodically back up your important data. To start, you can either create a new MySQL schedule, or you can edit the existing schedule stub which has been provided for you.\r\n\r\nGoto the Ditto schedules directory:\r\n\r\n\t$ cd /opt/ditto/schedules\r\n\t\r\nIf creating a new MySQL schedule, create a file in the above directory which describes the action in a way you can easily determine what it's doing, prefixed with a 3 digit number and prepended with **\".mysql**\".\r\n\r\n\t$ touch 003-all-production-databases.mysql\r\n\t\r\nIf you want to use the existing stub, open the default schedule to edit it:\r\n\r\n\t$ vi 001-all-databases.mysql\r\n\t\r\nThe number prefix before the action description is used to process schedules in a specific order. Files do not need to have a unique number in their filename.\r\n\r\nThe **\".mysql\"** file extension tells Ditto to use the MySQL action handler to deal with the schedule.\r\n\r\nTo get the blank schedule running, you will need to add the action instructions into the file which you created above:\r\n\r\n\t$ vi /opt/ditto/schedules/003-all-production-databases.mysql\r\n\t\r\nAdd the following content into the schedule:\r\n\r\n\t#!/usr/bin/env bash\r\n\t#\r\n\r\n\tWHEN=\"0 21 * * *\"\r\n\r\n\tMYSQL_USERNAME=username\r\n\tMYSQL_PASSWORD=password\r\n\t#MYSQL_DATABASES=all\r\n\t#MYSQL_HOSTNAME=localhost\r\n\t#MYSQL_GZIP_DATA=false\r\n\t#MYSQL_DATED_DUMP=true\r\n\t#MYSQL_HOTCOPY=false\r\n\r\nYou will need to change the Username and Password properties, however all of the other settings will work as their defaults.\r\n\r\nTo back up individual databases, change the databases property to a space seperated list of database names in double quotes.\r\n\r\nThe **WHEN** property is used to tell the schedule when it is allowed to execute. The string specified for WHEN refers to a dumbed down version of a regular cron expression. For example, if you wanted the MySQL schedule to run at 02:25 PM daily, you would specify the following:\r\n\r\n\tWHEN=\"25 14 * * *\"\r\n\t\r\nThe expressions, however, **do not support advanced operators**. Basically, you can only use single or double digit numbers for all of the values. An asterisk implies that it should always run for that specific field. (See the cron man page for more information about the field orders).\r\n\r\n#####S3 backups (Simple storage service)######\r\n\r\nIf you want to backup files to S3, you will need to configure an S3 schedule for Ditto which will periodically push your important data to the cloud. To start, you can either create a new S3 schedule, or you can edit the existing schedule stub which has been provided for you.\r\n\r\nGoto the Ditto schedules directory:\r\n\r\n\t$ cd /opt/ditto/schedules\r\n\r\nIf creating a new S3 schedule, create a file in the above directory which describes the action in a way you can easily determine what it's doing, prefixed with a 3 digit number and prepended with **\".mysql**\".\r\n\t\r\n\t$ touch 900-backups.s3\r\n\t\r\nIf you want to use the existing stub, open the default schedule to edit it:\r\n\r\n\t$ vi 999-backup.s3\r\n\t\r\nThe number prefix before the action description is used to process schedules in a specific order. Files do not need to have a unique number in their filename.\r\n\r\nThe **\".s3\"** file extension tells Ditto to use the S3 action handler to deal with the schedule.\r\n\r\nTo get the blank schedule running, you will need to add the action instructions into the file which you created above:\r\n\r\n\t$ vi /opt/ditto/schedules/900-backups.s3\r\n\t\r\nAdd the following content into the schedule:\r\n\r\n\t#!/usr/bin/env bash\r\n\t#\r\n\r\n\tWHEN=\"0 23 * * *\"\r\n\t\r\n\tS3_ACCESS_KEY=\"\"\r\n\tS3_SECRET_KEY=\"\"\r\n\tS3_BUCKET_URI=\"\"\r\n\tS3_USE_ENCRYPTION=false\r\n\tS3_USE_COMPRESSION=false\r\n\t#S3_MD5_CHECKING=true\r\n\t#S3_REMOVE_DELETED=false\r\n\t#S3_PRESERVE_PERMISSIONS=true\r\n\tS3_MAX_CPU=75\r\n\r\nYou will need to set the access key, secret key and bucket URI properties, however all of the other settings will work as their defaults.\r\n\r\nWhen the S3 schedule runs, it will automatically synchronize all files from the Ditto backups directory to the specified Bucket location which by default is **/opt/ditto/backups**.\r\n\r\nYou can override the path which the schedule is using as the source location by configuring the following property:\r\n\r\n\tS3_BACKUP_DIR=/path/to/my/dir\r\n\r\nThe **WHEN** property is used to tell the schedule when it is allowed to execute. The string specified for WHEN refers to a dumbed down version of a regular cron expression. For example, if you wanted the S3 schedule to run at 04:45 PM daily, you would specify the following:\r\n\r\n\tWHEN=\"45 16 * * *\"\r\n\t\r\nThe expressions, however, **do not support advanced operators**. Basically, you can only use single or double digit numbers for all of the values. An asterisk implies that it should always run for that specific field. (See the cron man page for more information about the field orders).\r\n\r\n#### 3. Troubleshooting ####\r\n\r\nAll logging information is by default, written to syslog using logger. On RedHat/CentOS systems, you can look at what Ditto is doing using the following command:\r\n\r\n\t$ tail -f /var/log/messages | grep DITTO\r\n\t\r\nOn Debian based systems such as Ubuntu, you can run the following command:\r\n\r\n\t$ tail -f /var/log/rsyslog | grep DITTO\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}